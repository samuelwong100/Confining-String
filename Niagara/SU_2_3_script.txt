#!/bin/bash
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=80
#SBATCH --time=1:00:00
#SBATCH --job-name SU_2_3
#SBATCH --output=out/%x-%j.out
#SBATCH --mail-user=samuelsy.wong@mail.utoronto.ca
#SBATCH --mail-type=ALL #email you everything

cd $SLURM_SUBMIT_DIR # Equivalent to /scratch/e/epoppitz/mwbub/jobs/confinement/SU5

# Load modules and Python virtual environment
module restore confine_module
source ~/.virtualenvs/confine_envs/bin/activate

# Run serial jobs
timeout 59m ./SU5_run_parallel.sh $k
#parallel "python <scriptname>.py {script parameters}" ::: <list of script parameters>
#parallel "python SU5.py {}" ::: {5..100}
timeout 59m "python trial_run.py {}" ::: {}
EXIT=$?

# Resubmit if timed out
if [ $EXIT -eq 124 ]
then
    ssh -t nia-login01 "cd $SLURM_SUBMIT_DIR; sbatch --export=k=$k --job-name=SU5_k$k SU5.sh"
fi
